name: æ„å»º Windows EXE

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  push:
    tags:
      - 'v*'  # å½“æ¨é€ç‰ˆæœ¬æ ‡ç­¾æ—¶è‡ªåŠ¨æ„å»º

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    
    - name: è®¾ç½® Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        cd "5.ç•Œé¢/æ¡ä»¶è¾ƒä¸ºç®€å•+å¤šè¡Œè¡¨"
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: æ„å»º EXEï¼ˆä½¿ç”¨specæ–‡ä»¶ï¼‰
      run: |
        cd "5.ç•Œé¢/æ¡ä»¶è¾ƒä¸ºç®€å•+å¤šè¡Œè¡¨"
        pyinstaller build_exe.spec --clean
      env:
        PYTHONIOENCODING: utf-8
    
    - name: åˆ›å»ºéƒ¨ç½²åŒ…ç›®å½•ç»“æ„
      shell: cmd
      run: |
        cd "5.ç•Œé¢/æ¡ä»¶è¾ƒä¸ºç®€å•+å¤šè¡Œè¡¨"
        if not exist "éƒ¨ç½²åŒ…" mkdir "éƒ¨ç½²åŒ…"
        copy dist\AIç®€å†åˆç­›ç³»ç»Ÿ.exe éƒ¨ç½²åŒ…\
        if not exist "éƒ¨ç½²åŒ…\data" mkdir "éƒ¨ç½²åŒ…\data"
        if not exist "éƒ¨ç½²åŒ…\output" mkdir "éƒ¨ç½²åŒ…\output"
        if not exist "éƒ¨ç½²åŒ…\logs" mkdir "éƒ¨ç½²åŒ…\logs"
    
    - name: ä¸Šä¼ æ„å»ºäº§ç‰©ï¼ˆEXEæ–‡ä»¶ï¼‰
      uses: actions/upload-artifact@v4
      with:
        name: windows-exe-standalone
        path: "5.ç•Œé¢/æ¡ä»¶è¾ƒä¸ºç®€å•+å¤šè¡Œè¡¨/dist/AIç®€å†åˆç­›ç³»ç»Ÿ.exe"
        retention-days: 30
    
    - name: ä¸Šä¼ å®Œæ•´éƒ¨ç½²åŒ…
      uses: actions/upload-artifact@v4
      with:
        name: windows-deployment-package
        path: "5.ç•Œé¢/æ¡ä»¶è¾ƒä¸ºç®€å•+å¤šè¡Œè¡¨/éƒ¨ç½²åŒ…/"
        retention-days: 30
    
    - name: æ˜¾ç¤ºæ„å»ºä¿¡æ¯
      shell: cmd
      run: |
        cd "5.ç•Œé¢/æ¡ä»¶è¾ƒä¸ºç®€å•+å¤šè¡Œè¡¨"
        echo "âœ… æ„å»ºå®Œæˆï¼"
        echo "ğŸ“¦ EXEæ–‡ä»¶ä½ç½®: dist/AIç®€å†åˆç­›ç³»ç»Ÿ.exe"
        if exist "dist\AIç®€å†åˆç­›ç³»ç»Ÿ.exe" (
            dir dist\AIç®€å†åˆç­›ç³»ç»Ÿ.exe
            echo "æ–‡ä»¶å¤§å°:"
            for %%A in (dist\AIç®€å†åˆç­›ç³»ç»Ÿ.exe) do echo %%~zA å­—èŠ‚
        )
