# 📋 固定字段模式说明

## 问题背景

之前生成的 JSON 文件存在**字段不一致**的问题：
- 有些岗位缺少某些字段（如职称要求、持证要求）
- 有些岗位的结构不同（如岗位9的岗位任职条件是简单数组）

这导致：
- ❌ 无法用统一的格式处理所有记录
- ❌ 导入数据库时需要动态字段处理
- ❌ 转换为 Excel 时列不对齐

---

## 解决方案：固定字段模式

### 核心原则

✅ **所有岗位输出相同的字段结构**
✅ **字段顺序固定不变**
✅ **如果原文为空，字段依然存在，值为空**

---

## 字段定义

### 资格条件（固定6个字段）

| 序号 | 字段名 | 结构 | 空值格式 |
|------|--------|------|----------|
| 1 | 学历要求 | `[{"原文": ""}, {"规整后": {"条件":"", "排名":[], "学历":[]}}]` | 条件为空，数组为空 |
| 2 | 专业要求 | `[{"原文": ""}, {"规整后": {"条件":"", "专业":[], "经历":[]}}]` | 条件为空，数组为空 |
| 3 | 年龄要求 | `[{"原文": ""}, {"规整后": ""}]` | 空字符串 |
| 4 | 绩效要求 | `[{"原文": ""}, {"规整后": {"条件":"", "系统内":"", "系统外":""}}]` | 所有字符串为空 |
| 5 | 职称要求 | `[{"原文": ""}, {"规整后": []}]` | 空数组 |
| 6 | 工作经历 | `[{"原文": ""}, {"规整后": {"条件":"", "南方电网公司系统内应聘人员":"", "南方电网公司系统外应聘人员":""}}]` | 所有字符串为空 |

### 岗位任职条件（固定3个字段）

| 序号 | 字段名 | 结构 | 空值格式 |
|------|--------|------|----------|
| 1 | 工作经验 | `[{"原文": ""}, {"规整后": ""}]` | 空字符串 |
| 2 | 能力要求 | `[]` | 空数组 |
| 3 | 持证要求 | `[{"原文": ""}, {"规整后": ""}]` | 空字符串 |

---

## 示例对比

### ❌ 修复前（字段不一致）

**岗位1（有工作经验）**:
```json
{
  "岗位任职条件": [
    {"工作经验": [{"原文": "3年及以上"}, {"规整后": "≥3"}]},
    {"能力要求": [...]},
    {"持证要求": [{"原文": ""}, {"规整后": ""}]}
  ]
}
```

**岗位9（无工作经验，结构不同）**:
```json
{
  "岗位任职条件": [
    "1. 能力要求：\n（1）...",
    "（2）...",
    "（3）..."
  ]
}
```

❌ 问题：
- 岗位9缺少"工作经验"和"持证要求"字段
- 岗位9的能力要求是字符串数组，不是对象

---

### ✅ 修复后（字段一致）

**岗位1（有工作经验）**:
```json
{
  "岗位任职条件": [
    {"工作经验": [{"原文": "3年及以上"}, {"规整后": "≥3"}]},
    {"能力要求": [...]},
    {"持证要求": [{"原文": ""}, {"规整后": ""}]}
  ]
}
```

**岗位9（无工作经验）**:
```json
{
  "岗位任职条件": [
    {"工作经验": [{"原文": ""}, {"规整后": ""}]},
    {"能力要求": ["1. 能力要求：", "（1）...", "（2）...", "（3）..."]},
    {"持证要求": [{"原文": ""}, {"规整后": ""}]}
  ]
}
```

✅ 优点：
- 所有岗位都有3个字段
- 字段顺序一致
- 结构统一

---

## 优势

### 1. 数据库导入
```sql
-- 可以使用固定的表结构
CREATE TABLE positions (
  id INT,
  education_requirement JSON,
  major_requirement JSON,
  age_requirement JSON,
  performance_requirement JSON,
  title_requirement JSON,
  work_history_requirement JSON,
  work_experience JSON,
  ability_requirement JSON,
  certificate_requirement JSON
);
```

### 2. Excel 转换
| 岗位 | 学历要求 | 专业要求 | 年龄要求 | 绩效要求 | 职称要求 | 工作经历 | 工作经验 | 能力要求 | 持证要求 |
|------|----------|----------|----------|----------|----------|----------|----------|----------|----------|
| 岗位1 | ... | ... | ≤40 | ... | | ... | ≥3 | ... | |
| 岗位9 | ... | ... | ≤40 | ... | | ... | | ... | |

### 3. 程序处理
```python
# 统一的处理逻辑
for position in positions:
    # 所有岗位都有这些字段
    education = position['资格条件'][0]['学历要求']
    major = position['资格条件'][1]['专业要求']
    age = position['资格条件'][2]['年龄要求']
    performance = position['资格条件'][3]['绩效要求']
    title = position['资格条件'][4]['职称要求']
    work_history = position['资格条件'][5]['工作经历']
    
    work_exp = position['岗位任职条件'][0]['工作经验']
    ability = position['岗位任职条件'][1]['能力要求']
    certificate = position['岗位任职条件'][2]['持证要求']
```

---

## 验证结果

### 统计信息
- ✅ 岗位数量: 30
- ✅ 资格条件字段: 6 个（每个岗位）
- ✅ 岗位任职条件字段: 3 个（每个岗位）
- ✅ 结构一致性: 100%

### 测试命令
```bash
python3 detect_merged_cells_with_accuracy_position_adjust.py
```

生成文件：`条件要求较简单的部分岗位岗位要求-模拟数据_规整后.json`

---

## 技术实现

### 关键代码改动

#### 1. 资格条件固定字段
```python
def parse_qualification(qualifications_list, text):
    # 初始化所有字段内容
    education_content = ""
    major_content = ""
    age_content = ""
    performance_content = ""
    title_content = ""
    work_history_content = ""
    
    # 解析文本，填充有内容的字段
    # ...
    
    # 固定输出六个字段（即使为空）
    qualifications_list.append({"学历要求": [...]})
    qualifications_list.append({"专业要求": [...]})
    qualifications_list.append({"年龄要求": [...]})
    qualifications_list.append({"绩效要求": [...]})
    qualifications_list.append({"职称要求": [...]})
    qualifications_list.append({"工作经历": [...]})
```

#### 2. 岗位任职条件固定字段
```python
def parse_position_requirements(requirements_list, text):
    # 初始化所有字段
    work_exp_content = ""
    ability_items = []
    cert_content = ""
    
    # 解析文本，填充有内容的字段
    # ...
    
    # 固定输出三个字段（即使为空）
    requirements_list.append({"工作经验": [...]})
    requirements_list.append({"能力要求": ability_items})
    requirements_list.append({"持证要求": [...]})
```

---

## 使用场景

### ✅ 适用于

1. **数据库导入** - 统一的表结构
2. **Excel 转换** - 固定的列
3. **批量处理** - 统一的代码逻辑
4. **数据分析** - 方便统计和对比
5. **API 接口** - 统一的返回格式

### ❌ 不适用于

1. **动态字段场景** - 需要根据实际内容动态字段
2. **极简 JSON** - 不希望有空字段
3. **文件大小敏感** - 空字段会增加文件大小

---

## 总结

固定字段模式通过**统一结构**解决了字段不一致的问题，使得：

✅ **所有岗位格式一致**  
✅ **便于程序处理**  
✅ **便于数据库导入**  
✅ **便于Excel转换**  
✅ **规整后字段自动填充**  

这是**方案2：固定字段（所有字段都输出）**的完整实现！
