# 项目结构说明

本项目已完整合并 `7.LLM_resume_filter` 的所有功能，形成统一的简历筛选系统。

## 📁 项目结构

```
条件较为简单+多行表/
├── backend.py                    # FastAPI 后端服务主文件
├── config.py                     # 配置文件（LLM配置）
├── requirements.txt               # Python依赖包
├── README.md                      # 项目说明文档
│
├── parsers/                       # Excel解析模块
│   ├── detect_merged_cells_with_accuracy_dan.py          # 简历单行表解析
│   └── detect_merged_cells_with_accuracy_position_adjust.py  # 岗位需求表解析（含规整）
│
├── core/                          # 核心功能模块
│   ├── __init__.py
│   ├── screener.py                # 主筛选器类
│   ├── toolkit.py                 # 筛选工具箱
│   └── models.py                  # 数据模型
│
├── filters/                       # 筛选器模块（按筛选条件分类）
│   ├── __init__.py
│   ├── base.py                    # 基础筛选器类（抽象基类）
│   ├── education.py               # 学历筛选
│   ├── major.py                   # 专业筛选
│   ├── age.py                     # 年龄筛选
│   ├── performance.py             # 绩效筛选
│   ├── title.py                   # 职称筛选
│   ├── work_experience.py         # 工作经历筛选
│   ├── work_years.py              # 工作经验筛选
│   └── political_status.py        # 政治面貌筛选
│
├── matchers/                      # 匹配器模块
│   ├── __init__.py
│   ├── rule_matcher.py            # 规则匹配器（所有规则匹配逻辑）
│   └── llm_matcher.py             # LLM匹配器（所有LLM匹配逻辑）
│
├── extractors/                    # 数据提取器模块
│   ├── __init__.py
│   ├── requirement_extractor.py   # 岗位要求提取器
│   └── resume_extractor.py        # 简历数据提取器
│
├── exporters/                     # 导出模块
│   ├── __init__.py
│   └── result_exporter.py         # 结果导出器
│
├── managers/                      # 管理器模块
│   ├── __init__.py
│   └── llm_manager.py             # LLM模型管理器
│
├── utils/                         # 工具模块
│   ├── __init__.py
│   ├── logger_config.py           # 日志配置模块
│   ├── major_library.py           # 专业库管理（加载、映射构建）
│   ├── calculator.py              # 计算工具（年龄、工作年限等）
│   └── data_loader.py             # 数据加载工具
│
├── data/                          # 数据目录
│   ├── 专业库.json                # 专业分类库
│   ├── 院校库.json                # 院校属性库（985/211等）
│   ├── *.json                     # 解析后的岗位数据和简历数据
│   └── *_规整后.json              # 岗位数据规整后版本
│
└── logs/                          # 日志目录
    └── resume_filter.log          # 统一日志文件（所有模块日志集中输出）
```

## 🎯 核心功能

### 1. Excel 解析功能
- **简历解析**：`parsers/detect_merged_cells_with_accuracy_dan.py`（单行表格式）
  - 解析多行表格式的简历Excel文件
  - 自动识别合并单元格
  - 输出结构化JSON数据

- **岗位解析**：`parsers/detect_merged_cells_with_accuracy_position_adjust.py`
  - 解析岗位需求明细表Excel文件
  - 自动填充"规整后"字段
  - 支持生成两个版本：原始版本和规整后版本

### 2. 筛选功能
支持8个筛选维度：
1. **学历要求**：匹配最高学历和全日制学历，支持985/211院校判断
2. **专业要求**：使用专业库进行专业匹配
3. **年龄要求**：计算年龄并匹配年龄限制
4. **绩效要求**：检查年度绩效情况（支持系统内/系统外）
5. **职称要求**：匹配职称等级
6. **工作经历**：检查相关工作经历
7. **工作年限**：计算并匹配工作年限要求
8. **政治面貌**：匹配政治面貌要求

### 3. 匹配策略
- **规则匹配**：优先使用规则匹配，快速准确
- **LLM匹配**：复杂情况自动切换到LLM匹配
- **智能匹配**：自动匹配岗位名称与简历应聘岗位

### 4. Web服务
- **FastAPI后端**：提供RESTful API接口
- **文件上传**：支持Excel文件上传
- **实时筛选**：上传后立即进行筛选
- **结果导出**：自动保存筛选结果

## 📋 使用流程

### 1. 启动服务

```bash
cd "5.界面/条件较为简单+多行表"
python3 backend.py
```

服务将在 `http://127.0.0.1:8000` 启动

### 2. 上传文件

通过Web界面或API上传：
- **简历文件**：多行表格式的Excel文件
- **岗位文件**：岗位需求明细表Excel文件

### 3. 自动处理

系统会自动：
1. 解析Excel文件为JSON
2. 保存JSON到 `data/` 目录
3. 执行AI筛选
4. 返回筛选结果

### 4. 查看结果

- **API响应**：直接返回JSON格式的筛选结果
- **本地文件**：`简历初筛结果.json`
- **日志文件**：`logs/resume_filter.log`

## 🔧 配置说明

### LLM配置

编辑 `config.py`：

```python
# 阿里云 DashScope API Key
DASHSCOPE_API_KEY = "your-api-key"

# 模型名称
LLM_MODEL = "qwen-max"

# Base URL
DASHSCOPE_BASE_URL = "https://dashscope.aliyuncs.com/compatible-mode/v1"
```

### 数据文件

确保以下文件存在于 `data/` 目录：
- `专业库.json`：专业分类库
- `院校库.json`：院校属性库（985/211等）

## 📊 输出文件说明

### 解析后的JSON文件

所有解析后的JSON文件保存在 `data/` 目录：

1. **简历JSON**：`（现RPA小工具流程）简历导入多行表-xxx.json`
   - 包含完整的简历信息
   - 结构化数据格式

2. **岗位JSON（原始）**：`条件要求较简单的部分岗位岗位要求-模拟数据.json`
   - 包含"原文"和"规整后"字段
   - 规整后字段已自动填充

3. **岗位JSON（规整后）**：`条件要求较简单的部分岗位岗位要求-模拟数据_规整后.json`
   - 与原始版本结构相同
   - 规整后字段已填充

### 筛选结果文件

- `简历初筛结果.json`：包含所有筛选结果的详细信息

## 🔄 与 7.LLM_resume_filter 的关系

本项目已完整合并 `7.LLM_resume_filter` 的所有功能：

✅ **已合并的模块**：
- core/（核心功能）
- filters/（筛选器）
- matchers/（匹配器）
- managers/（管理器）
- utils/（工具模块）
- extractors/（提取器）- 新增
- exporters/（导出器）- 新增

✅ **已合并的数据**：
- 专业库.json
- 院校库.json

✅ **已更新的功能**：
- backend.py 现在从本地导入所有模块
- 不再依赖 `7.LLM_resume_filter` 目录
- 所有功能完全独立

## 📝 注意事项

1. **数据格式**：确保上传的Excel文件符合系统要求的格式
2. **专业库**：专业匹配依赖 `data/专业库.json`，确保文件存在且格式正确
3. **院校库**：学历要求中的985/211判断依赖 `data/院校库.json`
4. **LLM服务**：如果使用LLM匹配，确保API Key配置正确
5. **日志文件**：日志文件会持续增长，定期清理或配置日志轮转

## 🚀 开发说明

### 添加新的筛选条件

1. 在 `filters/` 目录下创建新的筛选器文件
2. 继承 `BaseFilter` 类
3. 实现 `filter` 方法
4. 在 `core/toolkit.py` 中添加对应的筛选方法
5. 在 `core/screener.py` 中调用新的筛选方法

### 添加新的匹配规则

1. 在 `matchers/rule_matcher.py` 中添加新的匹配方法
2. 在对应的筛选器中调用新的匹配方法

### 使用LLM匹配

当规则匹配无法处理复杂情况时，系统会自动切换到LLM匹配：

1. 在 `matchers/llm_matcher.py` 中添加LLM匹配方法
2. 在筛选器中调用LLM匹配方法
