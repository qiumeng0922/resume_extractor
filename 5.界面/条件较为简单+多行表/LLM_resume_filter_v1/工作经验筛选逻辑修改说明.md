# 工作经验筛选逻辑修改说明

## 修改时间
2026-01-15

## 修改目标
优化"工作经验"筛选规则，使其能够智能判断是否需要进行相关工作经验匹配（LLM判断）或仅进行工作年限判断（规则匹配）。

## 修改内容

### 1. 修改的文件

#### 1.1 `filters/work_years.py` - 工作经验筛选器
**修改前逻辑：**
- 直接调用 LLM 进行工作经验判断

**修改后逻辑：**
1. 从"工作经验"字段提取"原文"
2. 判断原文中是否包含以下关键词：
   - "相关工作经验"
   - "相关经验"
   - "相关岗位工作经验"
   - "相关研究经验"
3. 如果包含上述关键词：
   - 先进行 LLM 相关工作经验判断
   - LLM 判断通过后，再进行工作年限判断（规则匹配）
   - 两项判断都通过才算通过
4. 如果不包含上述关键词：
   - 仅进行工作年限判断（规则匹配）

#### 1.2 `matchers/rule_matcher.py` - 规则匹配器
**修改的方法：** `match_work_years_rule`

**增强功能：**
1. 支持多种数据格式解析：
   - 格式1：`{"min_years": 3}`
   - 格式2：`{"规整后": "≥3"}` 或 `{"规整后": "3"}`
2. 使用正则表达式从"规整后"字段提取年限数字
3. 如果没有提取到年限要求，默认通过

#### 1.3 `matchers/llm_matcher.py` - LLM匹配器
**修改内容：**
- 删除了调试用的 `print` 语句，保持代码整洁

#### 1.4 `extractors/requirement_extractor.py` - 要求提取器
**修改的方法：** `get_normalized_value`

**修改前逻辑：**
- 优先返回"规整后"的值，如果为空则返回包含"原文"的字典

**修改后逻辑：**
- 始终返回包含"原文"的字典
- 如果有"规整后"的值，也一并包含在返回的字典中
- 确保下游能够同时获取到"原文"和"规整后"的值

## 工作流程示例

### 示例1：仅有年限要求
**工作经验要求：** "3年及以上工作经验。"

**判断流程：**
1. 提取原文：`"3年及以上工作经验。"`
2. 检查关键词：不包含"相关工作经验"等关键词
3. 仅进行工作年限判断：要求 ≥3年
4. 结果：根据简历的参加工作时间计算年限，判断是否满足

### 示例2：仅有相关工作经验要求
**工作经验要求：** "具备人工智能技术研发、电力企业生产技术业务、信息技术业务或调度控制业务相关经验者优先。"

**判断流程：**
1. 提取原文：`"具备人工智能技术研发...相关经验者优先。"`
2. 检查关键词：包含"相关经验"
3. 需要进行 LLM 相关工作经验判断
4. 不需要进行工作年限判断（因为原文没有明确年限要求）
5. 结果：根据 LLM 判断结果决定是否通过

### 示例3：既有年限又有相关工作经验要求
**工作经验要求：** "3年以上工作经验，有2年及以上上市公司证券事务代表、董事会办公室、法律合规部或相关岗位工作经验者优先。"

**判断流程：**
1. 提取原文和规整后值
2. 检查关键词：包含"相关岗位工作经验"
3. 先进行 LLM 相关工作经验判断
4. 如果 LLM 判断不通过，直接返回不通过
5. 如果 LLM 判断通过，继续进行工作年限判断：要求 ≥3年
6. 结果：两项判断都通过才算通过

## 优势

1. **智能判断**：自动识别是否需要进行相关工作经验判断，避免不必要的 LLM 调用
2. **节省成本**：对于仅有年限要求的岗位，使用规则匹配，不调用 LLM，节省时间和成本
3. **准确性提升**：对于有相关工作经验要求的岗位，先用 LLM 判断相关性，再用规则判断年限，确保两项都满足
4. **兼容性好**：支持多种数据格式，能够正确解析"≥3"、"3"等不同格式的年限要求

## 测试建议

运行筛选程序，观察以下情况：
1. 仅有年限要求的岗位：应只进行规则匹配，不调用 LLM
2. 仅有相关工作经验要求的岗位：应调用 LLM 进行相关性判断
3. 既有年限又有相关工作经验要求的岗位：应先 LLM 判断，后规则判断

查看日志文件 `logs/resume_filter.log`，确认判断流程符合预期。
