<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾…å¤„ç†ç®€å†åˆ—è¡¨ - AIç®€å†åˆç­›ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e8eaed;
        }

        .header-icon {
            width: 32px;
            height: 32px;
            margin-right: 12px;
            background-color: #4285f4;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .header-title {
            font-size: 24px;
            font-weight: 600;
            color: #202124;
        }

        .upload-section {
            background-color: #f8f9fa;
            border: 2px dashed #dadce0;
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
        }

        .upload-area {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input-label {
            display: inline-block;
            padding: 10px 20px;
            background-color: white;
            border: 1px solid #dadce0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background-color: #f8f9fa;
            border-color: #4285f4;
        }

        .file-input {
            display: none;
        }

        .file-name {
            display: block;
            margin-top: 8px;
            font-size: 12px;
            color: #5f6368;
        }

        .upload-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .upload-btn:hover {
            background-color: #3367d6;
        }

        .upload-btn:disabled {
            background-color: #dadce0;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            margin: 16px 0;
            text-align: center;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4285f4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filter-section {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #5f6368;
        }

        .filter-select, .filter-input {
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 14px;
            min-width: 180px;
        }

        .search-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: auto;
        }

        .search-btn:hover {
            background-color: #3367d6;
        }

        .actions-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .export-btn {
            background-color: white;
            color: #5f6368;
            border: 1px solid #dadce0;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .export-btn:hover {
            background-color: #f8f9fa;
        }

        .batch-confirm-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .batch-confirm-btn:hover {
            background-color: #3367d6;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #202124;
            border-bottom: 2px solid #e8eaed;
            white-space: nowrap;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e8eaed;
            color: #5f6368;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-passed {
            background-color: #e6f4ea;
            color: #137333;
        }

        .status-rejected {
            background-color: #fce8e6;
            color: #c5221f;
        }

        .action-link {
            color: #4285f4;
            text-decoration: none;
            margin-right: 12px;
            cursor: pointer;
        }

        .action-link:hover {
            text-decoration: underline;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #e8eaed;
        }

        .pagination-info {
            color: #5f6368;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .page-size-select {
            padding: 6px 8px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 14px;
        }

        .page-btn {
            padding: 6px 12px;
            border: 1px solid #dadce0;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .page-btn:hover {
            background-color: #f8f9fa;
        }

        .page-btn.active {
            background-color: #4285f4;
            color: white;
            border-color: #4285f4;
        }

        .page-btn:disabled {
            background-color: #f8f9fa;
            color: #dadce0;
            cursor: not-allowed;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #5f6368;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .key-profile {
            white-space: pre-line;
            line-height: 1.6;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background-color: #e6f4ea;
            color: #137333;
            border-left: 4px solid #137333;
        }

        .alert-error {
            background-color: #fce8e6;
            color: #c5221f;
            border-left: 4px solid #c5221f;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜ -->
        <div class="header">
            <div class="header-icon">ğŸ“‹</div>
            <h1 class="header-title">å¾…å¤„ç†ç®€å†åˆ—è¡¨</h1>
        </div>

        <!-- æ¶ˆæ¯æç¤º -->
        <div id="alert" class="alert"></div>

        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-section">
            <h3 style="margin-bottom: 16px; color: #202124;">ä¸Šä¼ æ–‡ä»¶</h3>
            <div class="upload-area">
                <div class="file-input-wrapper">
                    <label class="file-input-label" for="resumeFile">
                        ğŸ“„ é€‰æ‹©ç®€å†æ–‡ä»¶
                    </label>
                    <input type="file" id="resumeFile" class="file-input" accept=".xlsx,.xls">
                    <span class="file-name" id="resumeFileName">è¯·é€‰æ‹©ï¼šï¼ˆç°RPAå°å·¥å…·æµç¨‹ï¼‰ç®€å†å¯¼å…¥å¤šè¡Œè¡¨.xlsx</span>
                </div>
                <div class="file-input-wrapper">
                    <label class="file-input-label" for="positionFile">
                        ğŸ“‘ é€‰æ‹©å²—ä½éœ€æ±‚æ–‡ä»¶
                    </label>
                    <input type="file" id="positionFile" class="file-input" accept=".xlsx,.xls">
                    <span class="file-name" id="positionFileName">è¯·é€‰æ‹©ï¼šæ¡ä»¶è¦æ±‚è¾ƒç®€å•çš„éƒ¨åˆ†å²—ä½å²—ä½è¦æ±‚-æ¨¡æ‹Ÿæ•°æ®.xlsx</span>
                </div>
            </div>
            <button class="upload-btn" id="uploadBtn" disabled>ğŸš€ å¼€å§‹å¤„ç†</button>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 12px; color: #5f6368;">æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</p>
            </div>
        </div>

        <!-- ç­›é€‰åŒºåŸŸ -->
        <div class="filter-section">
            <div class="filter-group">
                <label class="filter-label">å²—ä½ï¼š</label>
                <select class="filter-select" id="positionFilter">
                    <option value="">å…¨éƒ¨å²—ä½</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">AIåˆç­›çŠ¶æ€ï¼š</label>
                <select class="filter-select" id="statusFilter">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="æ‹Ÿé€šè¿‡">æ‹Ÿé€šè¿‡</option>
                    <option value="æ‹Ÿæ·˜æ±°">æ‹Ÿæ·˜æ±°</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">å€™é€‰äººä¿¡æ¯ï¼š</label>
                <input type="text" class="filter-input" id="searchInput" placeholder="æœç´¢å§“åã€å­¦æ ¡ç­‰">
            </div>
            <button class="search-btn" id="searchBtn">ğŸ” æŸ¥è¯¢</button>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="actions-section">
            <button class="export-btn" id="exportBtn">â¬‡ï¸ å¯¼å‡º</button>
            <button class="batch-confirm-btn" id="batchConfirmBtn">ä¸€é”®å…¨éƒ¨ç¡®è®¤</button>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="table-wrapper">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>åºå·</th>
                        <th>å§“å</th>
                        <th>å…³é”®ç”»åƒ</th>
                        <th>åº”è˜å²—ä½</th>
                        <th>AIåˆç­›ç»“æœ</th>
                        <th>æ·˜æ±°åŸå› </th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-icon">ğŸ“­</div>
                            <p>æš‚æ— æ•°æ®ï¼Œè¯·ä¸Šä¼ æ–‡ä»¶å¼€å§‹å¤„ç†</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- åˆ†é¡µ -->
        <div class="pagination">
            <div class="pagination-info">
                å…±<span id="totalCount">0</span>æ¡è®°å½• æ¯é¡µæ˜¾ç¤ºï¼š
                <select class="page-size-select" id="pageSizeSelect">
                    <option value="2">2</option>
                    <option value="5" selected>5</option>
                    <option value="100">100</option>
                </select>
            </div>
            <div class="pagination-controls">
                <button class="page-btn" id="prevBtn" disabled>Â« ä¸Šä¸€é¡µ</button>
                <div id="pageNumbers"></div>
                <button class="page-btn" id="nextBtn" disabled>ä¸‹ä¸€é¡µ Â»</button>
                <button class="page-btn" id="confirmPageBtn">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let pageSize = 5;

        // API é…ç½®
        const API_BASE_URL = 'http://127.0.0.1:8000';

        // DOM å…ƒç´ 
        const resumeFile = document.getElementById('resumeFile');
        const positionFile = document.getElementById('positionFile');
        const resumeFileName = document.getElementById('resumeFileName');
        const positionFileName = document.getElementById('positionFileName');
        const uploadBtn = document.getElementById('uploadBtn');
        const loading = document.getElementById('loading');
        const alert = document.getElementById('alert');
        const positionFilter = document.getElementById('positionFilter');
        const statusFilter = document.getElementById('statusFilter');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const exportBtn = document.getElementById('exportBtn');
        const batchConfirmBtn = document.getElementById('batchConfirmBtn');
        const tableBody = document.getElementById('tableBody');
        const totalCount = document.getElementById('totalCount');
        const pageSizeSelect = document.getElementById('pageSizeSelect');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const confirmPageBtn = document.getElementById('confirmPageBtn');
        const pageNumbers = document.getElementById('pageNumbers');

        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        resumeFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                resumeFileName.textContent = file.name;
                checkUploadReady();
            }
        });

        positionFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                positionFileName.textContent = file.name;
                checkUploadReady();
            }
        });

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥ä¸Šä¼ 
        function checkUploadReady() {
            uploadBtn.disabled = !(resumeFile.files[0] && positionFile.files[0]);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showAlert(message, type = 'success') {
            alert.textContent = message;
            alert.className = `alert alert-${type} show`;
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // ä¸Šä¼ å¹¶å¤„ç†æ–‡ä»¶
        uploadBtn.addEventListener('click', async () => {
            const resume = resumeFile.files[0];
            const position = positionFile.files[0];

            if (!resume || !position) {
                showAlert('è¯·é€‰æ‹©ä¸¤ä¸ªæ–‡ä»¶', 'error');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            loading.classList.add('active');
            uploadBtn.disabled = true;

            try {
                // åˆ›å»º FormData
                const formData = new FormData();
                formData.append('resume_file', resume);
                formData.append('position_file', position);

                // å‘é€è¯·æ±‚
                const response = await fetch(`${API_BASE_URL}/api/screen`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    allData = result.data;
                    filteredData = [...allData];
                    
                    // æ›´æ–°å²—ä½ç­›é€‰é€‰é¡¹
                    updatePositionFilter();
                    
                    // æ˜¾ç¤ºæ•°æ®
                    currentPage = 1;
                    renderTable();
                    
                    showAlert(`å¤„ç†æˆåŠŸï¼å…± ${result.statistics.total} ä»½ç®€å†ï¼Œé€šè¿‡ ${result.statistics.passed} ä»½ï¼Œæ·˜æ±° ${result.statistics.rejected} ä»½`, 'success');
                } else {
                    throw new Error(result.message || 'å¤„ç†å¤±è´¥');
                }

            } catch (error) {
                console.error('å¤„ç†å¤±è´¥:', error);
                showAlert('å¤„ç†å¤±è´¥: ' + error.message, 'error');
            } finally {
                loading.classList.remove('active');
                uploadBtn.disabled = false;
            }
        });

        // æ›´æ–°å²—ä½ç­›é€‰é€‰é¡¹
        function updatePositionFilter() {
            const positions = [...new Set(allData.map(item => item.åº”è˜å²—ä½))];
            positionFilter.innerHTML = '<option value="">å…¨éƒ¨å²—ä½</option>';
            positions.forEach(pos => {
                const option = document.createElement('option');
                option.value = pos;
                option.textContent = pos;
                positionFilter.appendChild(option);
            });
        }

        // ç­›é€‰æ•°æ®
        function filterData() {
            const position = positionFilter.value;
            const status = statusFilter.value;
            const search = searchInput.value.toLowerCase();

            filteredData = allData.filter(item => {
                const matchPosition = !position || item.åº”è˜å²—ä½ === position;
                const matchStatus = !status || item.AIåˆç­›ç»“æœ === status;
                const matchSearch = !search || 
                    item.å§“å.toLowerCase().includes(search) ||
                    item.å…³é”®ç”»åƒ.toLowerCase().includes(search);
                
                return matchPosition && matchStatus && matchSearch;
            });

            currentPage = 1;
            renderTable();
        }

        // æŸ¥è¯¢æŒ‰é’®
        searchBtn.addEventListener('click', filterData);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                filterData();
            }
        });

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = filteredData.slice(start, end);

            if (pageData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-icon">ğŸ“­</div>
                            <p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•°æ®</p>
                        </td>
                    </tr>
                `;
            } else {
                tableBody.innerHTML = pageData.map(item => `
                    <tr>
                        <td>${item.åºå·}</td>
                        <td>${item.å§“å}</td>
                        <td><div class="key-profile">${item.å…³é”®ç”»åƒ}</div></td>
                        <td>${item.åº”è˜å²—ä½}</td>
                        <td>
                            <span class="status-badge ${item.AIåˆç­›ç»“æœ === 'æ‹Ÿé€šè¿‡' ? 'status-passed' : 'status-rejected'}">
                                ${item.AIåˆç­›ç»“æœ}
                            </span>
                        </td>
                        <td>${item.æ·˜æ±°åŸå› }</td>
                        <td>
                            <a class="action-link" href="#" onclick="viewDetail(${item.åºå·}); return false;">ç®€å†è¯¦æƒ…</a>
                            <a class="action-link" href="#" onclick="pass(${item.åºå·}); return false;">é€šè¿‡</a>
                            <a class="action-link" href="#" onclick="reject(${item.åºå·}); return false;">æ·˜æ±°</a>
                        </td>
                    </tr>
                `).join('');
            }

            totalCount.textContent = filteredData.length;
            renderPagination();
        }

        // æ¸²æŸ“åˆ†é¡µ
        function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;

            // ç”Ÿæˆé¡µç 
            let pages = [];
            if (totalPages <= 5) {
                pages = Array.from({length: totalPages}, (_, i) => i + 1);
            } else {
                if (currentPage <= 3) {
                    pages = [1, 2, 3, 4, 5];
                } else if (currentPage >= totalPages - 2) {
                    pages = [totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages];
                } else {
                    pages = [currentPage - 2, currentPage - 1, currentPage, currentPage + 1, currentPage + 2];
                }
            }

            pageNumbers.innerHTML = pages.map(page => `
                <button class="page-btn ${page === currentPage ? 'active' : ''}" 
                        onclick="goToPage(${page})">${page}</button>
            `).join('');
        }

        // ç¿»é¡µ
        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        });

        nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        });

        pageSizeSelect.addEventListener('change', (e) => {
            pageSize = parseInt(e.target.value);
            currentPage = 1;
            renderTable();
        });

        function goToPage(page) {
            currentPage = page;
            renderTable();
        }

        // æ“ä½œå‡½æ•°
        function viewDetail(id) {
            const item = allData.find(item => item.åºå· === id);
            alert(`æŸ¥çœ‹ç®€å†è¯¦æƒ…ï¼š\n\nå§“åï¼š${item.å§“å}\nå²—ä½ï¼š${item.åº”è˜å²—ä½}\nçŠ¶æ€ï¼š${item.AIåˆç­›ç»“æœ}`);
        }

        function pass(id) {
            const item = allData.find(item => item.åºå· === id);
            item.AIåˆç­›ç»“æœ = 'æ‹Ÿé€šè¿‡';
            item.æ·˜æ±°åŸå›  = '';
            renderTable();
            showAlert(`${item.å§“å} å·²æ ‡è®°ä¸ºé€šè¿‡`, 'success');
        }

        function reject(id) {
            const item = allData.find(item => item.åºå· === id);
            const reason = prompt('è¯·è¾“å…¥æ·˜æ±°åŸå› ï¼š');
            if (reason !== null) {
                item.AIåˆç­›ç»“æœ = 'æ‹Ÿæ·˜æ±°';
                item.æ·˜æ±°åŸå›  = reason;
                renderTable();
                showAlert(`${item.å§“å} å·²æ ‡è®°ä¸ºæ·˜æ±°`, 'success');
            }
        }

        // å¯¼å‡º
        exportBtn.addEventListener('click', () => {
            const dataStr = JSON.stringify(filteredData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ç®€å†åˆç­›ç»“æœ.json';
            a.click();
            URL.revokeObjectURL(url);
            showAlert('å¯¼å‡ºæˆåŠŸ', 'success');
        });

        // ä¸€é”®ç¡®è®¤
        batchConfirmBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦å…¨éƒ¨ç¡®è®¤å—ï¼Ÿ')) {
                showAlert('å·²å…¨éƒ¨ç¡®è®¤', 'success');
            }
        });

        // åˆå§‹åŒ–
        renderTable();
    </script>
</body>
</html>




